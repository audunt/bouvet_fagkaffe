@using System.Security.Claims
@using bouvet_fagkaffe_frontend.Components.Elements
@inject Operations _operations
@rendermode InteractiveServer
@page "/"

<PageTitle>Home</PageTitle>

<h1>Bouvet Fagkaffe</h1>


<div class="container">
    <div class="row">
        <div class="col-12">
            Welcome to fagkaffe @user?.FullName()
            <br />
        </div>
    </div>
    <div class="row">
        <div class="col-6">
            <h3>My Lectures</h3>
            @if (lectures != null && lectures.Count() > 0)
            {
                @foreach (var lecture in lectures)
                {
                    @if(lecture.HeldBy.Contains(user!) && lecture.Status != LectureStatus.Cancelled)
                    {
                         <LectureComp 
                             lecture="@lecture"
                             isAdminOrHomeView="@isHomeView"
                             user="@user">
                         </LectureComp>
                    }
                }
            }
            else if (lectures != null && lectures.Count() == 0)
            {
                <p>There are currently no lectures to display</p>
            }
            else 
            {
                <p>Loading...</p>
            }
        </div>
        <div class="col-6">
            <h3>My Candidates</h3>
            @if (candidates != null && candidates.Count() > 0)
            {
                @foreach (var candidate in candidates)
                {
                    @if(candidate.ProposedBy == user || candidate.RegisteredPresenters.Contains(user!))
                    {
                        <CandidateComp 
                            candidate="@candidate"
                            user="@user">
                        </CandidateComp>
                    }
                }
            }
            else if (candidates != null && candidates.Count() == 0)
            {
                <p>There are currently no candidates to display</p>
            }
            else
            {
                <p>Loading...</p>
            }
        </div>
    </div>
</div>


@code
{
    //Define the variables to use
    [CascadingParameter]
    protected User? user { get; set; }

    private List<Lecture>? lectures { get; set; }
    private List<Candidate>? candidates { get; set; }
    private bool isHomeView { get; set; } = true;


    // override intitialization of the page
    protected override async Task OnInitializedAsync()
    {
        if (user != null)
        {
            lectures = await _operations.GetAllLecturesForUser(user);
            candidates = await _operations.GetAllCandidatesForUser(user);
        }
        await base.OnInitializedAsync();
    }
}